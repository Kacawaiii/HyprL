<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard â€” HyprL</title>
    <meta name="description" content="Your trading signals dashboard.">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“ˆ</text></svg>">
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Dashboard-specific styles */
        .dashboard-header {
            padding: 2rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 2rem;
        }

        .dashboard-title {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .tier-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .tier-free { background: rgba(255, 255, 255, 0.1); color: #999; }
        .tier-starter { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .tier-pro { background: rgba(139, 92, 246, 0.2); color: #8b5cf6; }
        .tier-team { background: rgba(236, 72, 153, 0.2); color: #ec4899; }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .dashboard-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 1.5rem;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(20px);
        }

        .dashboard-card h3 {
            font-size: 0.875rem;
            color: #888;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .dashboard-card .value {
            font-size: 2.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            font-family: 'SF Mono', Monaco, monospace;
        }

        .dashboard-card .change {
            font-size: 0.875rem;
            color: #888;
        }

        .change.positive { color: #10b981; }
        .change.negative { color: #ef4444; }

        /* Locked content overlay */
        .locked-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(8px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
            border-radius: 16px;
        }

        .locked-overlay .lock-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .locked-overlay .lock-text {
            font-size: 0.875rem;
            color: #888;
            margin-bottom: 1rem;
        }

        .locked-overlay .upgrade-btn {
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, #8b5cf6, #ec4899);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            font-size: 0.875rem;
        }

        /* Signals table */
        .signals-section {
            margin-top: 2rem;
        }

        .signals-section h2 {
            font-size: 1.25rem;
            margin-bottom: 1rem;
        }

        .signals-table {
            width: 100%;
            border-collapse: collapse;
        }

        .signals-table th,
        .signals-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        .signals-table th {
            color: #888;
            font-weight: 500;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .signals-table td {
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 0.875rem;
        }

        .signal-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .signal-badge.long { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .signal-badge.short { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .signal-badge.flat { background: rgba(255, 255, 255, 0.1); color: #888; }

        /* API section */
        .api-section {
            margin-top: 2rem;
        }

        .api-section h2 {
            font-size: 1.25rem;
            margin-bottom: 1rem;
        }

        .api-key-box {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-top: 1rem;
        }

        .api-key-box code {
            flex: 1;
            font-family: 'SF Mono', Monaco, monospace;
            color: #10b981;
            word-break: break-all;
        }

        .api-key-box button {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            white-space: nowrap;
            transition: background 0.2s;
        }

        .api-key-box button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Content Grid Layout */
        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
            margin-top: 2rem;
        }

        @media (max-width: 1024px) {
            .content-grid { grid-template-columns: 1fr; }
        }

        /* Loading state */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 400px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: #8b5cf6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Not logged in state */
        .login-prompt {
            text-align: center;
            padding: 4rem 2rem;
        }

        .login-prompt h2 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .login-prompt p {
            color: #888;
            margin-bottom: 2rem;
        }

        /* Sidebar cards */
        .sidebar-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }

        .sidebar-card-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-card-title {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sidebar-card-body {
            padding: 1rem 1.5rem;
        }

        .quick-stat {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .quick-stat:last-child {
            border-bottom: none;
        }

        .quick-stat-label {
            color: #888;
            font-size: 0.875rem;
        }

        .quick-stat-value {
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 0.875rem;
        }

        /* Feature list */
        .feature-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .feature-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 0;
            font-size: 0.875rem;
        }

        .feature-item.locked {
            opacity: 0.5;
        }

        /* Upgrade banner */
        .upgrade-banner {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(236, 72, 153, 0.2));
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 16px;
            padding: 2rem;
            margin-top: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1.5rem;
        }

        .upgrade-banner h3 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }

        .upgrade-banner p {
            color: #888;
            margin-bottom: 1rem;
        }

        .upgrade-features {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .upgrade-feature {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        .upgrade-feature .check {
            color: #10b981;
        }

        /* User menu fix for dashboard */
        .user-menu {
            position: relative;
        }
    </style>
</head>
<body>
    <!-- Grid Background -->
    <div class="grid-bg"></div>

    <!-- Glow Orbs -->
    <div class="glow-orb glow-orb-1"></div>
    <div class="glow-orb glow-orb-2"></div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <a href="index.html" class="logo">HyprL</a>
            <nav class="nav">
                <a href="index.html#features">Features</a>
                <a href="index.html#pricing">Pricing</a>
            </nav>
            <div class="user-menu" id="user-menu" style="display: none;">
                <div class="user-avatar" id="user-avatar">U</div>
                <div class="user-dropdown">
                    <a href="dashboard.html" class="active">Dashboard</a>
                    <a href="#" id="manage-subscription">Subscription</a>
                    <a href="#" onclick="signOutUser()">Sign Out</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container" style="padding-top: 100px; min-height: 100vh;">
        <!-- Loading State -->
        <div id="loading-state" class="loading">
            <div class="loading-spinner"></div>
        </div>

        <!-- Login Prompt (hidden by default) -->
        <div id="login-prompt" class="login-prompt" style="display: none;">
            <h2>Sign in to access your dashboard</h2>
            <p>Track your signals, view performance, and manage your subscription.</p>
            <button class="btn-primary btn-large" onclick="signInWithGoogle()">Sign in with Google</button>
        </div>

        <!-- Dashboard Content (hidden by default) -->
        <div id="dashboard-content" style="display: none;">
            <div class="dashboard-header">
                <h1 class="dashboard-title">Welcome back, <span id="user-name">Trader</span></h1>
                <span class="tier-badge tier-free" id="tier-badge">Free</span>
            </div>

            <!-- Stats Grid -->
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <h3>Total Return</h3>
                    <div class="value green">+127%</div>
                    <div class="change positive">+2.3% today</div>
                </div>

                <div class="dashboard-card">
                    <h3>Win Rate</h3>
                    <div class="value">73.4%</div>
                    <div class="change">Last 30 days</div>
                </div>

                <div class="dashboard-card" id="card-sharpe">
                    <h3>Sharpe Ratio</h3>
                    <div class="value">17.91</div>
                    <div class="change">Annualized</div>
                    <div class="locked-overlay" id="lock-sharpe" style="display: none;">
                        <span class="lock-icon">ðŸ”’</span>
                        <span class="lock-text">Starter+ feature</span>
                        <a href="index.html#pricing" class="upgrade-btn">Upgrade</a>
                    </div>
                </div>

                <div class="dashboard-card" id="card-drawdown">
                    <h3>Max Drawdown</h3>
                    <div class="value green">-0.82%</div>
                    <div class="change">All-time low</div>
                    <div class="locked-overlay" id="lock-drawdown" style="display: none;">
                        <span class="lock-icon">ðŸ”’</span>
                        <span class="lock-text">Starter+ feature</span>
                        <a href="index.html#pricing" class="upgrade-btn">Upgrade</a>
                    </div>
                </div>
            </div>

            <!-- Content Grid -->
            <div class="content-grid">
                <!-- Main Column -->
                <div>
                    <!-- Recent Signals -->
                    <section class="signals-section">
                        <h2>Recent Signals</h2>
                        <div class="dashboard-card" style="position: relative; padding: 0;">
                            <table class="signals-table">
                                <thead>
                                    <tr>
                                        <th>Time</th>
                                        <th>Symbol</th>
                                        <th>Direction</th>
                                        <th>Probability</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="signals-tbody">
                                    <tr>
                                        <td>2025-01-19 14:00</td>
                                        <td>NVDA</td>
                                        <td><span class="signal-badge long">LONG</span></td>
                                        <td>0.72</td>
                                        <td>Executed</td>
                                    </tr>
                                    <tr>
                                        <td>2025-01-19 13:00</td>
                                        <td>QQQ</td>
                                        <td><span class="signal-badge short">SHORT</span></td>
                                        <td>0.68</td>
                                        <td>Executed</td>
                                    </tr>
                                    <tr>
                                        <td>2025-01-18 15:00</td>
                                        <td>MSFT</td>
                                        <td><span class="signal-badge long">LONG</span></td>
                                        <td>0.65</td>
                                        <td>Closed +1.2%</td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="locked-overlay" id="lock-signals" style="display: none;">
                                <span class="lock-icon">ðŸ”’</span>
                                <span class="lock-text">Starter+ feature</span>
                                <a href="index.html#pricing" class="upgrade-btn">Upgrade to see signals</a>
                            </div>
                        </div>
                    </section>

                    <!-- API Access (Pro+) -->
                    <section class="api-section" id="api-section" style="display: none;">
                        <h2>API Access</h2>
                        <div class="dashboard-card" style="position: relative;">
                            <p style="color: #888; margin-bottom: 1rem;">Use your API key to receive real-time signals via webhook or JSON API.</p>
                            <div class="api-key-box">
                                <code id="api-key">Loading...</code>
                                <button onclick="toggleApiKey()" id="toggle-key-btn">Show</button>
                                <button onclick="copyApiKey()">Copy</button>
                            </div>
                            <p style="color: #666; font-size: 0.75rem; margin-top: 1rem;">Webhook URL: https://api.hyprl.io/v1/signals?key=YOUR_API_KEY</p>
                            <div class="locked-overlay" id="lock-api" style="display: none;">
                                <span class="lock-icon">ðŸ”’</span>
                                <span class="lock-text">Pro+ feature</span>
                                <a href="index.html#pricing" class="upgrade-btn">Upgrade to Pro</a>
                            </div>
                        </div>
                    </section>

                    <!-- Team Features (Team only) -->
                    <section class="api-section" id="team-section" style="display: none;">
                        <h2>Team Management</h2>
                        <div class="dashboard-card" style="position: relative;">
                            <p style="color: #888; margin-bottom: 1rem;">Invite team members and manage access.</p>
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                                <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px; flex: 1; min-width: 200px;">
                                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">1/5</div>
                                    <div style="color: #888; font-size: 0.875rem;">Team members</div>
                                </div>
                                <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px; flex: 1; min-width: 200px;">
                                    <button class="btn-primary" style="width: 100%;">Invite Member</button>
                                </div>
                            </div>
                            <div class="locked-overlay" id="lock-team" style="display: none;">
                                <span class="lock-icon">ðŸ”’</span>
                                <span class="lock-text">Team feature</span>
                                <a href="index.html#pricing" class="upgrade-btn">Upgrade to Team</a>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- Sidebar -->
                <div>
                    <!-- Account Summary -->
                    <div class="sidebar-card">
                        <div class="sidebar-card-header">
                            <span class="sidebar-card-title">Account Summary</span>
                        </div>
                        <div class="sidebar-card-body">
                            <div class="quick-stat">
                                <span class="quick-stat-label">Buying Power</span>
                                <span class="quick-stat-value" id="buying-power">$100,000</span>
                            </div>
                            <div class="quick-stat">
                                <span class="quick-stat-label">Cash Available</span>
                                <span class="quick-stat-value" id="cash-available">$100,000</span>
                            </div>
                            <div class="quick-stat">
                                <span class="quick-stat-label">Open Positions</span>
                                <span class="quick-stat-value" id="open-positions">0</span>
                            </div>
                            <div class="quick-stat">
                                <span class="quick-stat-label">Last Signal</span>
                                <span class="quick-stat-value" id="last-signal">â€”</span>
                            </div>
                        </div>
                    </div>

                    <!-- Your Plan -->
                    <div class="sidebar-card">
                        <div class="sidebar-card-header">
                            <span class="sidebar-card-title">Your Plan</span>
                            <span class="tier-badge" id="plan-badge">FREE</span>
                        </div>
                        <div class="sidebar-card-body">
                            <ul class="feature-list" id="feature-list">
                                <li class="feature-item">âœ“ Public track record</li>
                                <li class="feature-item">âœ“ Daily updates</li>
                                <li class="feature-item locked">âœ— Live signals</li>
                                <li class="feature-item locked">âœ— API access</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Upgrade Banner -->
            <div class="upgrade-banner" id="upgrade-banner" style="display: none;">
                <div>
                    <h3 id="upgrade-title">Unlock Live Trading Signals</h3>
                    <p id="upgrade-desc">Get real-time signals, email alerts, and full dashboard access</p>
                    <div class="upgrade-features" id="upgrade-features">
                        <div class="upgrade-feature"><span class="check">âœ“</span> Live signals every hour</div>
                        <div class="upgrade-feature"><span class="check">âœ“</span> Email alerts</div>
                        <div class="upgrade-feature"><span class="check">âœ“</span> 90-day history</div>
                    </div>
                </div>
                <a href="index.html#pricing" id="upgrade-btn" class="btn-primary btn-large">Upgrade Now</a>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p class="footer-copy">Â© 2025 HyprL. All rights reserved.</p>
        </div>
    </footer>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>

    <script>
        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyBnc42sHAYxcRNfJXkvTsHoS9q_eFcjoo0",
            authDomain: "hyprl-ffb97.firebaseapp.com",
            projectId: "hyprl-ffb97",
            storageBucket: "hyprl-ffb97.firebasestorage.app",
            messagingSenderId: "443742012218",
            appId: "1:443742012218:web:ffc35b141d7c948f21c603"
        };

        // Stripe config
        const STRIPE_PRICES = {
            starter: "price_1Slc8vRfqAn8K66XVF7KOFOX",
            pro: "price_1Slc8vRfqAn8K66XQCYitR2T",
            team: "price_1Slc8wRfqAn8K66XsbgomOL0"
        };

        const STRIPE_PAYMENT_LINKS = {
            starter: "https://buy.stripe.com/fZueVf75pecN2CmcTMgrS00",
            pro: "https://buy.stripe.com/28EdRb9dx0lXel41b4grS01",
            team: "https://buy.stripe.com/cNibJ3blF8Stb8S9HAgrS02"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Current user tier
        let currentTier = 'free';
        let userApiKey = null;
        let apiKeyVisible = false;

        // Tier hierarchy
        const tierHierarchy = {
            'free': 0,
            'starter': 1,
            'pro': 2,
            'team': 3
        };

        const tierConfig = {
            free: {
                name: 'Free',
                badge: 'FREE',
                badgeClass: 'tier-free',
                features: [
                    { text: 'Public track record', locked: false },
                    { text: 'Daily updates', locked: false },
                    { text: 'Live signals', locked: true },
                    { text: 'API access', locked: true }
                ],
                showUpgrade: true
            },
            starter: {
                name: 'Starter',
                badge: 'â‚¬29/MO',
                badgeClass: 'tier-starter',
                features: [
                    { text: 'Live signals', locked: false },
                    { text: 'Email alerts', locked: false },
                    { text: '90-day history', locked: false },
                    { text: 'API access', locked: true }
                ],
                showUpgrade: true
            },
            pro: {
                name: 'Pro',
                badge: 'â‚¬79/MO',
                badgeClass: 'tier-pro',
                features: [
                    { text: 'Everything in Starter', locked: false },
                    { text: 'REST API access', locked: false },
                    { text: 'Webhook integrations', locked: false },
                    { text: 'Priority support', locked: false }
                ],
                showUpgrade: false,
                showApiSection: true
            },
            team: {
                name: 'Team',
                badge: 'â‚¬199/MO',
                badgeClass: 'tier-team',
                features: [
                    { text: 'Everything in Pro', locked: false },
                    { text: '5 team seats', locked: false },
                    { text: 'Custom integrations', locked: false },
                    { text: 'Dedicated support', locked: false }
                ],
                showUpgrade: false,
                showApiSection: true,
                showTeamSection: true
            }
        };

        // Check if user has access to a feature
        function hasAccess(requiredTier) {
            return tierHierarchy[currentTier] >= tierHierarchy[requiredTier];
        }

        // Update UI based on tier
        function updateTierUI(tier) {
            currentTier = tier;
            const config = tierConfig[tier] || tierConfig.free;

            // Update badge
            const badge = document.getElementById('tier-badge');
            badge.textContent = config.name;
            badge.className = 'tier-badge ' + config.badgeClass;

            // Update plan badge
            const planBadge = document.getElementById('plan-badge');
            planBadge.textContent = config.badge;
            planBadge.className = 'tier-badge ' + config.badgeClass;

            // Update feature list
            const featureList = document.getElementById('feature-list');
            featureList.innerHTML = config.features.map(f =>
                `<li class="feature-item ${f.locked ? 'locked' : ''}">${f.locked ? 'âœ—' : 'âœ“'} ${f.text}</li>`
            ).join('');

            // Show/hide locked overlays based on tier
            document.getElementById('lock-sharpe').style.display = hasAccess('starter') ? 'none' : 'flex';
            document.getElementById('lock-drawdown').style.display = hasAccess('starter') ? 'none' : 'flex';
            document.getElementById('lock-signals').style.display = hasAccess('starter') ? 'none' : 'flex';
            document.getElementById('lock-api').style.display = hasAccess('pro') ? 'none' : 'flex';
            document.getElementById('lock-team').style.display = hasAccess('team') ? 'none' : 'flex';

            // Show/hide sections
            document.getElementById('api-section').style.display = config.showApiSection ? 'block' : 'none';
            document.getElementById('team-section').style.display = config.showTeamSection ? 'block' : 'none';

            // Show/hide upgrade banner
            document.getElementById('upgrade-banner').style.display = config.showUpgrade ? 'flex' : 'none';
        }

        // Auth state listener
        auth.onAuthStateChanged(async (user) => {
            const loadingState = document.getElementById('loading-state');
            const loginPrompt = document.getElementById('login-prompt');
            const dashboardContent = document.getElementById('dashboard-content');
            const userMenu = document.getElementById('user-menu');
            const userAvatar = document.getElementById('user-avatar');
            const userName = document.getElementById('user-name');

            loadingState.style.display = 'none';

            if (user) {
                // User is signed in
                loginPrompt.style.display = 'none';
                dashboardContent.style.display = 'block';
                userMenu.style.display = 'block';

                // Set user info
                userAvatar.textContent = user.displayName ? user.displayName[0].toUpperCase() : 'U';
                userName.textContent = user.displayName ? user.displayName.split(' ')[0] : 'Trader';

                // Get user data from Firestore
                try {
                    const userDoc = await db.collection('users').doc(user.uid).get();
                    if (userDoc.exists) {
                        const userData = userDoc.data();
                        updateTierUI(userData.tier || 'free');
                        userApiKey = userData.apiKey || null;
                        if (userApiKey) {
                            document.getElementById('api-key').textContent = 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';
                        } else {
                            document.getElementById('api-key').textContent = 'No API key generated';
                        }
                    } else {
                        updateTierUI('free');
                    }
                } catch (error) {
                    console.error('Error fetching user data:', error);
                    updateTierUI('free');
                }
            } else {
                // User is signed out
                loginPrompt.style.display = 'block';
                dashboardContent.style.display = 'none';
                userMenu.style.display = 'none';
            }
        });

        // Google Sign In
        function signInWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .then((result) => {
                    console.log('Signed in:', result.user.email);
                    return db.collection('users').doc(result.user.uid).set({
                        email: result.user.email,
                        displayName: result.user.displayName,
                        tier: 'free',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    }, { merge: true });
                })
                .catch((error) => {
                    console.error('Sign in error:', error);
                    alert('Sign in failed: ' + error.message);
                });
        }

        // Sign Out
        function signOutUser() {
            auth.signOut()
                .then(() => {
                    window.location.href = 'index.html';
                });
        }

        // API Key functions
        function toggleApiKey() {
            const apiKeyEl = document.getElementById('api-key');
            const toggleBtn = document.getElementById('toggle-key-btn');
            if (!hasAccess('pro')) return;

            if (apiKeyVisible) {
                apiKeyEl.textContent = 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';
                toggleBtn.textContent = 'Show';
                apiKeyVisible = false;
            } else {
                apiKeyEl.textContent = userApiKey || 'No API key generated yet';
                toggleBtn.textContent = 'Hide';
                apiKeyVisible = true;
            }
        }

        function copyApiKey() {
            if (!hasAccess('pro') || !userApiKey) return;
            navigator.clipboard.writeText(userApiKey);
            alert('API key copied to clipboard!');
        }

        // Manage subscription
        document.getElementById('manage-subscription')?.addEventListener('click', (e) => {
            e.preventDefault();
            alert('Customer portal coming soon. Contact support to manage subscription.');
        });
    </script>
</body>
</html>
